---
title: 设计模式
date: 2018-02-24 16:42:42
categories: 设计模式
tags: [php, 设计模式]
---

> 设计模式的理解：代码设计经验的总结。
> 设计模式的作用：降低代码耦合度，提高代码重用性、可读性、可靠性。

## 单例模式

### 主要作用

在整个项目中创建唯一对象实例。

### 适用场景

如：数据库连接。

### 实现方法

+ $_instance必须声明为静态的私有变量。
+ 构造函数和析构函数必须声明为私有，防止外部程序new。
+ 私有的__clone()方法防止克隆对象。
+ getInstance()方法必须设置为公有的，必须调用此方法以返回实例的一个引用。

### 代码demo

```
<?php
 
class Singleton
{
    private static $instance;
    
    //私有构造方法，禁止使用new创建对象
    private function __construct() {}
    
    //私有析构方法
    private function __destruct() {}
    
    //将克隆方法设为私有，禁止克隆对象
    private function __clone() {}
        
    public static function getInstance() {
        if (!isset(self::$instance)) {
            self::$instance = new self;
        }
        return self::$instance;
    }
    
    public function say() {
        echo "这是用单例模式创建对象实例\n";
    }
    
    public function operation() {
        echo "这里可以添加其他方法和操作\n";
    }
}

$objSingle = Singleton::getInstance();
$objSingle->say();
$objSingle->operation();
 
$objSingleNew = Singleton::getInstance();
var_dump($shiyanlou === $objSingleNew);
```


## 简单工厂模式

### 主要作用

避免改变某个类的名字或者方法之后，在调用这个类的所有的代码中都修改它的名字或者参数。

### 实现方法

+ 工厂方法或者类生成对象，而不是在代码中直接new。 

### 代码demo

```
<?php 
//简单工厂模式
class Cat
{
    function __construct()
    {
        echo "I am Cat class <br>";
    }
}

class Dog
{
    function __construct()
    {
      echo "I am Dog class <br>";
    }
}

class Factory
{
    public static function CreateAnimal($name){
        if ($name == 'cat') {
            return new Cat();
        } elseif ($name == 'dog') {
            return new Dog();
        }
    }
}

$cat = Factory::CreateAnimal('cat');
$dog = Factory::CreateAnimal('dog');
```

## 注册模式

### 主要作用

解决全局共享和交换对象。

### 实现方法

+ 将对象注册到全局静态变量。
+ 任何地方直接去访问。

### 代码demo

```
<?php

class Register
{
    protected static $objects;
    
    function set($alias,$object) {
        self::$objects[$alias] = $object;
    }
    
    static function get($name) {
        return self::$objects[$name];
    }
    
    function _unset($alias) {
        unset(self::$objects[$alias]);
    }
}
```

## 适配器模式

### 主要作用

将各种截然不同的函数接口封装成统一的API。

### 适用场景

+ PHP中的数据库操作有MySQL，MySQLi，PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。
+ 可以将memcache,redis等不同的缓存函数适配成统一的API。 

### 实现方法

+ 首先定义一个接口（有几个方法，以及相应的参数）。
+ 有几种不同的情况，就写几个类实现该接口。

### 代码demo

```
接口 IDatabase
<?php
namespace IMooc;
interface IDatabase
{
    function connect($host, $user, $passwd, $dbname);
    function query($sql);
    function close();
}

MySQL
<?php
namespace IMooc\Database;
use IMooc\IDatabase;
class MySQL implements IDatabase
{
    protected $conn;
    function connect($host, $user, $passwd, $dbname)
    {
        $conn = mysql_connect($host, $user, $passwd);
        mysql_select_db($dbname, $conn);
        $this->conn = $conn;
    }

    function query($sql)
    {
        $res = mysql_query($sql, $this->conn);
        return $res;
    }

    function close()
    {
        mysql_close($this->conn);
    }
}

MySQLi
<?php
namespace IMooc\Database;
use IMooc\IDatabase;
class MySQLi implements IDatabase
{
    protected $conn;

    function connect($host, $user, $passwd, $dbname)
    {
        $conn = mysqli_connect($host, $user, $passwd, $dbname);
        $this->conn = $conn;
    }

    function query($sql)
    {
        return mysqli_query($this->conn, $sql);
    }

    function close()
    {
        mysqli_close($this->conn);
    }
}

PDO
<?php
namespace IMooc\Database;
use IMooc\IDatabase;
class PDO implements IDatabase
{
    protected $conn;
    function connect($host, $user, $passwd, $dbname)
    {
        $conn = new \PDO("mysql:host=$host;dbname=$dbname", $user, $passwd);
        $this->conn = $conn;
    }
function query($sql)
    {
        return $this->conn->query($sql);
    }

    function close()
    {
        unset($this->conn);
    }
}
```

## 策略模式

### 主要作用

定义一系列算法，将每个算法封装到具有公共接口的一系列策略类中，从而使它们可以相互替换，让算法可在不影响客户端的情况下发生变化。

### 适用场景


### 实现方法


### 代码demo


